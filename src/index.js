"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const event_1 = require("bdsx/event");
const __1 = require("..");
const navigation_1 = require("./navigation");
const blockpos_1 = require("bdsx/bds/blockpos");
const common_1 = require("bdsx/common");
const translate_1 = require("./utils/translate");
const actor_1 = require("bdsx/bds/actor");
function protect(player, position = blockpos_1.BlockPos.create(player.getPosition()), option) {
    const pos = navigation_1.LandPosXZ.create(position);
    const land = __1.EconomyLand.getLand(pos);
    const send = new translate_1.sendTranslate(player);
    if (player.getDimensionId() !== actor_1.DimensionId.Overworld)
        return;
    if (!land)
        return;
    if (__1.LandMain.isOwner(pos, player))
        return;
    if (!option)
        return common_1.CANCEL;
    if (__1.LandMain.isMember(pos, player) && __1.LandMain.getMemberOption(pos, option) === false) {
        send.error("player.error.permission");
        player.playSound("mob.villager.no");
        return common_1.CANCEL;
    }
    if (!__1.LandMain.isMember(pos, player) && __1.LandMain.getLandOption(pos, option) === false) {
        send.error("player.error.permission");
        return common_1.CANCEL;
    }
    return common_1.CANCEL;
}
event_1.events.itemUseOnBlock.on((ev) => protect(ev.actor, blockpos_1.BlockPos.create(ev.x, ev.y, ev.z), "UseBlock"));
event_1.events.blockInteractedWith.on((ev) => protect(ev.player, ev.blockPos, "UseBlock"));
event_1.events.farmlandDecay.on((ev) => protect(ev.culprit, ev.blockPos, "UseBlock"));
event_1.events.blockDestroy.on((ev) => protect(ev.player, ev.blockPos, "UseBlock"));
event_1.events.blockPlace.on((ev) => protect(ev.player, ev.blockPos, "UseBlock"));
event_1.events.buttonPress.on((ev) => protect(ev.player, ev.blockPos, "PressButton"));
event_1.events.chestOpen.on((ev) => protect(ev.player, ev.blockPos, "OpenChest"));
event_1.events.playerSleepInBed.on((ev) => protect(ev.player, ev.pos, "PlayerInteract"));
event_1.events.playerInteract.on((ev) => protect(ev.player, blockpos_1.BlockPos.create(ev.victim.getPosition()), "PlayerInteract"));
event_1.events.playerAttack.on((ev) => {
    if (ev.victim.isPlayer())
        return protect(ev.player, blockpos_1.BlockPos.create(ev.victim.getPosition()), "PVP");
    if (!ev.victim.hasFamily("monster"))
        return protect(ev.player, blockpos_1.BlockPos.create(ev.victim.getPosition()), "AttackMob");
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUFvQztBQUNwQywwQkFBMkM7QUFFM0MsNkNBQXNEO0FBQ3RELGdEQUE2QztBQUM3Qyx3Q0FBcUM7QUFDckMsaURBQWtEO0FBQ2xELDBDQUE2QztBQUU3QyxTQUFTLE9BQU8sQ0FBQyxNQUFjLEVBQUUsV0FBcUIsbUJBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsTUFBMEI7SUFDbkgsTUFBTSxHQUFHLEdBQUcsc0JBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDdkMsTUFBTSxJQUFJLEdBQUcsZUFBVyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN0QyxNQUFNLElBQUksR0FBRyxJQUFJLHlCQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFdkMsSUFBSSxNQUFNLENBQUMsY0FBYyxFQUFFLEtBQUssbUJBQVcsQ0FBQyxTQUFTO1FBQUUsT0FBTztJQUM5RCxJQUFJLENBQUMsSUFBSTtRQUFFLE9BQU87SUFDbEIsSUFBSSxZQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUM7UUFBRSxPQUFPO0lBQzFDLElBQUksQ0FBQyxNQUFNO1FBQUUsT0FBTyxlQUFNLENBQUM7SUFFM0IsSUFBSSxZQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsSUFBSSxZQUFRLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsS0FBSyxLQUFLLEVBQUU7UUFDbkYsSUFBSSxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUNwQyxPQUFPLGVBQU0sQ0FBQztLQUNqQjtJQUNELElBQUksQ0FBQyxZQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsSUFBSSxZQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsS0FBSyxLQUFLLEVBQUU7UUFDbEYsSUFBSSxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sZUFBTSxDQUFDO0tBQ2pCO0lBRUQsT0FBTyxlQUFNLENBQUM7QUFDbEIsQ0FBQztBQUVELGNBQU0sQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEtBQWUsRUFBRSxtQkFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7QUFDN0csY0FBTSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBQ25GLGNBQU0sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQWlCLEVBQUUsRUFBRSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBQ3hGLGNBQU0sQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7QUFDNUUsY0FBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQztBQUMxRSxjQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDO0FBQzlFLGNBQU0sQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7QUFDMUUsY0FBTSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7QUFDakYsY0FBTSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLG1CQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7QUFDakgsY0FBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRTtJQUMxQixJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFO1FBQUUsT0FBTyxPQUFPLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxtQkFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQztRQUFFLE9BQU8sT0FBTyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsbUJBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQzFILENBQUMsQ0FBQyxDQUFDIn0=